<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DOM的映射机制 | destiny&#39;Note</title>
    <meta name="description" content="生命的意义不仅是活着，而是我们给别人的生命带来了何种不同。">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.60759f37.css" as="style"><link rel="preload" href="/assets/js/app.543397e4.js" as="script"><link rel="preload" href="/assets/js/18.3f30a73a.js" as="script"><link rel="prefetch" href="/assets/js/10.404a1ed3.js"><link rel="prefetch" href="/assets/js/11.d96f7dd5.js"><link rel="prefetch" href="/assets/js/12.c4cb1460.js"><link rel="prefetch" href="/assets/js/13.298dcea8.js"><link rel="prefetch" href="/assets/js/14.76e374e9.js"><link rel="prefetch" href="/assets/js/15.cabafc9e.js"><link rel="prefetch" href="/assets/js/16.935fae54.js"><link rel="prefetch" href="/assets/js/17.bb6df115.js"><link rel="prefetch" href="/assets/js/19.3d3eb31b.js"><link rel="prefetch" href="/assets/js/2.12518157.js"><link rel="prefetch" href="/assets/js/20.6842d989.js"><link rel="prefetch" href="/assets/js/21.7d233f43.js"><link rel="prefetch" href="/assets/js/22.3937a0d4.js"><link rel="prefetch" href="/assets/js/23.3db3547e.js"><link rel="prefetch" href="/assets/js/24.780e473d.js"><link rel="prefetch" href="/assets/js/25.b1c68c3b.js"><link rel="prefetch" href="/assets/js/26.040427de.js"><link rel="prefetch" href="/assets/js/27.c2fc1028.js"><link rel="prefetch" href="/assets/js/28.b2dc56d1.js"><link rel="prefetch" href="/assets/js/29.9ba5aa00.js"><link rel="prefetch" href="/assets/js/3.d7fabb17.js"><link rel="prefetch" href="/assets/js/30.8d814049.js"><link rel="prefetch" href="/assets/js/31.9f4fe891.js"><link rel="prefetch" href="/assets/js/32.b5992aea.js"><link rel="prefetch" href="/assets/js/33.888ada65.js"><link rel="prefetch" href="/assets/js/34.92c0c121.js"><link rel="prefetch" href="/assets/js/35.b28520ca.js"><link rel="prefetch" href="/assets/js/36.b09dd09e.js"><link rel="prefetch" href="/assets/js/37.91962578.js"><link rel="prefetch" href="/assets/js/38.944ce5f2.js"><link rel="prefetch" href="/assets/js/39.29f98881.js"><link rel="prefetch" href="/assets/js/4.2b80a5e1.js"><link rel="prefetch" href="/assets/js/40.313a2fb9.js"><link rel="prefetch" href="/assets/js/41.20262907.js"><link rel="prefetch" href="/assets/js/42.2d40c066.js"><link rel="prefetch" href="/assets/js/43.4e623ee0.js"><link rel="prefetch" href="/assets/js/44.d51425ac.js"><link rel="prefetch" href="/assets/js/45.d8b4fa98.js"><link rel="prefetch" href="/assets/js/46.b92428bc.js"><link rel="prefetch" href="/assets/js/47.37328091.js"><link rel="prefetch" href="/assets/js/48.37c5318b.js"><link rel="prefetch" href="/assets/js/49.8d66a27d.js"><link rel="prefetch" href="/assets/js/5.ae847d8a.js"><link rel="prefetch" href="/assets/js/50.87e85266.js"><link rel="prefetch" href="/assets/js/51.39657d4b.js"><link rel="prefetch" href="/assets/js/52.cbfd4d25.js"><link rel="prefetch" href="/assets/js/6.db366183.js"><link rel="prefetch" href="/assets/js/7.ca596fdb.js"><link rel="prefetch" href="/assets/js/8.96a57609.js"><link rel="prefetch" href="/assets/js/9.50ff4134.js">
    <link rel="stylesheet" href="/assets/css/0.styles.60759f37.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">destiny'Note</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="https://www.yuque.com/destinytaoer/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  语雀
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div> <a href="https://github.com/destinytaoer/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="https://www.yuque.com/destinytaoer/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  语雀
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div> <a href="https://github.com/destinytaoer/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>DOM的映射机制</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/_posts/DOM%E7%9A%84%E6%98%A0%E5%B0%84%E6%9C%BA%E5%88%B6.html#改变元素对象的属性" class="sidebar-link">改变元素对象的属性</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/_posts/DOM%E7%9A%84%E6%98%A0%E5%B0%84%E6%9C%BA%E5%88%B6.html#在元素内部继续添加元素" class="sidebar-link">在元素内部继续添加元素</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/_posts/DOM%E7%9A%84%E6%98%A0%E5%B0%84%E6%9C%BA%E5%88%B6.html#在页面中追加已有元素" class="sidebar-link">在页面中追加已有元素</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h1> <p>这在我们平常操作 DOM 的时候司空见惯。就比如：我通过获取一个元素来改变其样式，自然而然的反映到 HTML 页面中。</p> <p>但是，我们操作 JS 对象的时候，本质上操作的是 JS 堆内存，为什么会反映到页面中呢？就是因为浏览器存在这个 DOM 的映射机制。</p> <h1 id="_1-什么是-dom-的映射机制？"><a href="#_1-什么是-dom-的映射机制？" aria-hidden="true" class="header-anchor">#</a> 1. 什么是 DOM 的映射机制？</h1> <p>我们使用 JS 从页面获取到的元素对象，或者自己手动创建的已经插入页面的元素对象，与页面中的 HTML 元素是绑定在一起的。也就是说修改其中一个，另一个也会跟着自动修改。这就是 DOM 的映射机制。</p> <h1 id="_2-形成映射的几种情形"><a href="#_2-形成映射的几种情形" aria-hidden="true" class="header-anchor">#</a> 2. 形成映射的几种情形</h1> <h2 id="改变元素对象的属性"><a href="#改变元素对象的属性" aria-hidden="true" class="header-anchor">#</a> 改变元素对象的属性</h2> <p>这是我们最常用到的一种情形。当我们需要为元素添加自定义属性、或者修改属性等，就可以从页面中获取到元素对象，然后对其进行修改，就能够自动反映到 HTML 页面元素上。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//=&gt; 修改从页面中获取的元素样式</span>
Div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span>

<span class="token comment">//=&gt; 修改已经插入页面的元素的属性</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
box<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p>这两种方式得到的元素对象，修改其属性，都能够直接反映到页面中，不需要再次插入页面中。</p> <h2 id="在元素内部继续添加元素"><a href="#在元素内部继续添加元素" aria-hidden="true" class="header-anchor">#</a> 在元素内部继续添加元素</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//=&gt; 在其内部插入标签或文本</span>
<span class="token keyword">var</span> list <span class="token operator">=</span> Div<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 空的元素集合</span>
Div<span class="token punctuation">.</span><span class="token function">innerHTML</span><span class="token punctuation">(</span><span class="token string">'&lt;li&gt;&lt;/li&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 有一个元素集合</span>

<span class="token comment">//=&gt; 添加自己创建的元素对象，同样原理</span>
Div<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在容器中的数据绑定前，我们获取容器中元素，得到一个空的元素集合，容器数据绑定后，我们不需要重新获取，DOM 的映射机制会帮我们把新增加的元素映射到之前获取的空集合中，让其变为有元素的集合。</p> <h2 id="在页面中追加已有元素"><a href="#在页面中追加已有元素" aria-hidden="true" class="header-anchor">#</a> 在页面中追加已有元素</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>list <span class="token operator">=</span> Div<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
Div<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>appendChild</code> 在追加元素对象的时候，如果这个元素在容器中已经存在，此时<strong>并不是克隆一份新的追加到末尾，而是把原有的元素移动到末尾。</strong></p> <blockquote><p>其根本原因在于，同一个元素在页面中，只能够有一个位置。把 JS 元素对象插入页面中某个位置，实际上就是把其绑定的 HTML 元素移动到那个位置上。</p></blockquote> <p>这里的元素已经存在有两种情形：</p> <ul><li>元素是从页面中获取到的</li> <li>创建的元素已经添加过一次，再次添加时</li></ul> <p>因此，就无需手动移除原先的元素，再进行添加。直接插入即可。</p> <h1 id="_3-特殊情况"><a href="#_3-特殊情况" aria-hidden="true" class="header-anchor">#</a> 3. 特殊情况</h1> <p><code>querySelectAll</code> 获取的集合是静态集合（staticNodeList），不存在上述所谓的映射机制，基于这个方法，数据绑定完成后需要重新获取一次才可以。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> box <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'#box'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> box1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'box'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>box<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//=&gt; 获取到的是 NodeList 对象</span>
console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>box1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//=&gt; 而这里获取到的是 HTMLElement 的实例</span>
</code></pre></div><p>这个特殊的 NodeList 不存在与 HTML 页面元素的映射，而且没有很多 HTMLElement 实例才拥有的方法。因此，使用这个方法的时候每次操作时，都应该重新获取。</p> <p>另外，jQuery 中获取的元素同样不存在这些映射，实现映射需要使用其内部的方法，而且要使用原生 HTMLElement 实例的方法，需要通过后面加 <code>[0]</code> 的方法转换为原生元素对象。</p> <p>另外，由于存在这种映射机制，在使用循环 DOM 中，改变了 DOM 的顺序，那么循环原本的顺序也就改变了。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>forEach<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>children<span class="token punctuation">,</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  parent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//=&gt; 这样做你会发现，循环完成后 children 改变了，不符合预期</span>
</code></pre></div><p>因此，真实项目中，不应该过分依赖于 DOM 的映射机制。</p> <blockquote class="blockquote-center">生命的意义不仅是活着，而是我们给别人的生命带来了何种不同。</blockquote></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/destinytaoer/blog/edit/master/blog/_posts/DOM的映射机制.md" target="_blank" rel="noopener noreferrer">编辑此页面</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新时间: </span> <span class="time">2019-2-14 18:51:42</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.543397e4.js" defer></script><script src="/assets/js/18.3f30a73a.js" defer></script>
  </body>
</html>
